# å‰ã®é–¢é€£è¨˜äº‹

ğŸ“–ã€€[ã‚¤ãƒ­ãƒ»ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã£ã¦ä½•ã ãœï¼ˆï¼¾ï½ï¼¾ï¼‰ï¼Ÿï¼œãã®ï¼‘ï¼](https://crieit.net/posts/4e1c338b0343829a093a90a4e716e472)  

# ã¯ã˜ã‚ã«

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ã‚¤ãƒ­ãƒ»ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®Ÿè£…ã—ã‚ˆã†ãœï¼Ÿã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€ã¾ãšã¯ã€€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã€€ï¼’äººã€€ã«å›ºå®šã—ã‚ˆã†ãœï¼Ÿã€  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
ã€Œã€€å‹è² ã¯ã€€ä¹±æ•°ã‚’ä½¿ã£ãŸã‚¸ãƒ£ãƒ³ã‚±ãƒ³ã§ã€ã€€ãƒ©ã‚¦ãƒ³ãƒ‰æ•°ã‚’å…¥åŠ›ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€ğŸ‘‡ã€€ãƒªãƒã‚¸ãƒˆãƒªã¯ä½œã£ã¦ãŠã„ãŸãœã€  

ğŸ“–ã€€[elo-rating-system](https://github.com/muzudho/elo-rating-system)  

ğŸ“„ `step_1_0.py`:  

```py
import random
#
# python step_1_0.py
#

# 0, 1, 2 ã®ã„ãšã‚Œã‹ã‚’è¿”ã™
def gyanken():
    return random.randint(0, 2)

if __name__ == "__main__":

    print("Please input round number(1-100):")
    round = int(input())

    counts = [0,0,0]

    for i in range(0, round):
        result = gyanken()

        counts[result] += 1

        if result == 0:
            print("aiko")
        elif result == 1:
            print("A win")
        elif result == 2:
            print("B win")
        else:
            print("Error")

    print(f"aiko: {counts[0]}, A win: {counts[1]}, B win: {counts[2]}")
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ğŸ‘†ã€€ã“ã‚ŒãŒã€€ã‚¸ãƒ£ãƒ³ã‚±ãƒ³ã€€ã ãœã€  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
ã€Œã€€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä»˜ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã€  

## å¼•ãåˆ†ã‘ã¯ã©ã†è¨ˆç®—ã™ã‚‹ï¼Ÿ

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€å¼•åˆ†ã‘ã®ã¨ãã€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç§»å‹•ã¯ã€€ã©ã†è¨ˆç®—ã™ã‚“ã®ï¼Ÿã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€ğŸ‘‡ã€€Wikipedia ã§ã¯ã€ã€€ãƒã‚§ã‚¹ã§ã¯ã€€å¼•ãåˆ†ã‘ã¯ã€€0.5å‹ã€0.5æ•—ã€€ã¨ã—ã¦ã„ã‚‹ã¨ã„ã†èª¬æ˜ãŒã‚ã‚‹ã ã‘ã§ã€è¨ˆç®—æ–¹æ³•ã¯æ›¸ã„ã¦ãªã„ãœã€  

ğŸ“–ã€€[ã‚¤ãƒ­ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://ja.wikipedia.org/wiki/ã‚¤ãƒ­ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ã˜ã‚ƒã‚ã€€ãƒã‚§ã‚¹ã®ã‚¦ã‚£ã‚­ã‚’è¦‹ã‚Œã°ã„ã„ã‚“ã ã€  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€0.5 å‹ ãƒã‚¤ãƒŠã‚¹ 0.5 æ•— ã¯ 0 ã ã‹ã‚‰ã€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ã€€0ã€€å‹•ãã‚‰ã—ã„ã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€å‹•ã‹ãªã„ã®ã‹ã€  

## ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®ãŒã€€ï¼ã€€ã®ï¼’è€…ã®ã¨ãã€å¯¾å±€å¾Œã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ã©ã†å‹•ãï¼Ÿ

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®ãŒã€€ï¼ã€€ã®ï¼’è€…ã®ã¨ãã€å¯¾å±€å¾Œã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ã©ã†å‹•ãã‚“ã ãœï¼Ÿã€  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
ã€Œã€€A å´ã®å‹ç‡ãŒ50ï¼…ã§ã€ B å´ã®å‹ç‡ãŒ50%ã§ã€K ãŒ 32 ã®ã¨ãã¯ 32 * 0.5 ã§ 16 å‹•ãã®ã‚ˆã€  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ãã†ã‹ã€€åˆ†ã‹ã£ãŸãœã€  

ğŸ“„ `step_1_1_0.py`:  

```py
#
# python step_1_1_0.py
#
import random

games = [0,0,0]


# 0, 1, 2 ã®ã„ãšã‚Œã‹ã‚’è¿”ã™
def on_gyanken_1():
    return random.randint(0, 2)


def main(
        on_gyanken,
        on_result,
        on_end):

    print("Please input round number(1-100):")
    round = int(input())


    for i in range(0, round):
        result_1 = on_gyanken()

        games[result_1] += 1

        on_result(result_1)

    on_end()


if __name__ == "__main__":

    def on_result_1(result):
        if result == 0:
            print("aiko")
        elif result == 1:
            print("A win")
        elif result == 2:
            print("B win")
        else:
            print("Error")


    def on_end_1():
        print(f"aiko: {games[0]}, A win: {games[1]}, B win: {games[2]}")


    main(on_gyanken=on_gyanken_1,
         on_result=on_result_1,
         on_end=on_end_1)
```

ğŸ“„ `step_2_0.py`:  

```py
#
# python step_1_1_0.py
#
import math

from step_1_1_0 import on_gyanken_1, games, main

# R0 = 2000
ratings = [0, 2000, 2000]

# Constant K
K = 32


# Rating calculate
def get_x_by_y(y):
    if y==0:
        return 1
    else:
        return 400 * math.log10(y)


# Rating calculate
def get_y_by_x(x):
    return x ** (x / 400)


# Win rate
def get_win_rate_for_upper_rating(win_games):
    return win_games / (win_games + 1)


# Win rate
def get_win_rate_for_lower_rating(win_games):
    return 1 / (win_games + 1)


if __name__ == "__main__":

    def on_result_1(result):


        # ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®
        ab = ratings[1] - ratings[2]
        ba = ratings[2] - ratings[1]
        y = abs(ba)
        print(f"y: {y}")
        x = get_x_by_y(y)


        # å‹ç‡
        win_rate_for_lower_rating = 1 / (x+1)
        #win_rate_for_upper_rating = x / (x+1)


        if result == 0:
            # ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯å‹•ãã¾ã›ã‚“
            print(f"aiko  >  ratings A {ratings[1]}, B {ratings[2]}")

        elif result == 1:
            offset = K * win_rate_for_lower_rating
            ratings[1] += offset
            ratings[2] -= offset
            print(f"A win  >  ratings A {ratings[1]}, B {ratings[2]}")

        elif result == 2:
            offset = K * win_rate_for_lower_rating
            ratings[2] += offset
            ratings[1] -= offset
            print(f"B win  >  ratings A {ratings[1]}, B {ratings[2]}")

        else:
            print("Error")


    def on_end_1():
        print(f"games:   aiko: {games[0]}, A win: {games[1]}, B win: {games[2]}")
        print(f"ratings: aiko: {ratings[0]}, A win: {ratings[1]}, B win: {ratings[2]}")


    main(on_gyanken=on_gyanken_1,
         on_result=on_result_1,
         on_end=on_end_1)
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ğŸ‘†ã€€ã†ãƒ¼ã‚€ã€€åˆ†ã‹ã‚‰ã‚“ã€  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ç«¯æ•°ã¯ã€€åˆ‡ã‚Šæ¨ã¦ãŸæ–¹ãŒã„ã„ã®ã‹ãªï¼Ÿã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€ã¾ãŸã€€æ˜æ—¥è€ƒãˆã‚ˆã†ãœï¼Ÿã€  

# (ğŸ“… 2023-12-12 tue) ã‚³ãƒ¼ãƒ‰æ›¸ã„ãŸ

ğŸ“„ `step_2_0.py`:  

```py
#
# python step_2_0.py
#
import math

from step_1_1_0 import on_gyanken_1, games, main

# R0 = 2000
ratings = [0, 2000, 2000]

# Constant K
K = 32


# ï¼‘å‹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¯¾å±€æ•°ï¼ˆæš—è¨˜è¡¨ã® x ï¼‰ã‚’å–å¾—
# å®Ÿæ•°ã§ã‚‚ç®—å‡ºã§ãã‚‹ãŒã€ï¼ˆ1.0 ä»¥ä¸Šã®æ•°ã«ãªã‚‹ã‚ˆã†æ•°å¼ã‚’èª¿æ•´ã—ã¦ã„ã‚‹å‰æã§ï¼‰æ•´æ•°ã«ã—ã¦è¿”ã™
def get_games_by_rating_difference(
        rating_difference): # æš—è¨˜è¡¨ã® y
    
    # ã‚¼ãƒ­ãªã‚‰
    if rating_difference==0:
        return 1
    
    # è² æ•°ãªã‚‰
    elif rating_difference <0:
        # è² æ•°ã‚’æŒ‡å®šã§ããªã„ã®ã§ã€ç¬¦å·ã‚’ã²ã£ãã‚Šè¿”ã—ã¦ã€ã‚ã¨ã§æˆ»ã™
        return -math.floor(400 * math.log10(-rating_difference))
        # ãƒã‚¤ãƒŠã‚¹ç¬¦å·ã®ä»˜ã‘ã‚‹ä½ç½®ã§çµæœãŒå¤‰ã‚ã£ã¦ãã‚‹ã®ã§æ³¨æ„
        #return math.floor(-400 * math.log10(-rating_difference))

    # æ­£ã®æ•°ãªã‚‰
    else:
        return math.floor(400 * math.log10(rating_difference))


# ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®ï¼ˆæš—è¨˜è¡¨ã® y ï¼‰ã‚’å–å¾—
def get_rating_difference_by_games(
        games): # æš—è¨˜è¡¨ã® x : å®Ÿæ•°
    return math.floor(10 ** (games / 400))


# Win rate : å®Ÿæ•°
def get_win_rate_for_upper_rating(win_games):
    return win_games / (win_games + 1)


# Win rate : å®Ÿæ•°
def get_win_rate_for_lower_rating(win_games):
    return 1 / (win_games + 1)


if __name__ == "__main__":

    def on_result_1(result):

        # ã‚ã„ã“
        if result == 0:
            print("""\
+------+
| aiko |
+------+\
                  """)
            # ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯å‹•ãã¾ã›ã‚“
            print(f"* ratings: A {ratings[1]}, B {ratings[2]}")

        # A ãŒå‹ã£ãŸ
        elif result == 1:
            print("""\
+-------+
| A win |
+-------+\
                  """)
            
            # b ã‹ã‚‰è¦‹ãŸ a ã¨ã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®
            difference_b_to_a = ratings[1] - ratings[2]
            print(f"* b ã‹ã‚‰è¦‹ãŸ a ã¨ã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®: {difference_b_to_a}")

            # b ã‹ã‚‰è¦‹ãŸ a ã«ï¼‘å‹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¯¾å±€æ•°
            games_b_to_a = get_games_by_rating_difference(difference_b_to_a)
            print(f"* b ã‹ã‚‰è¦‹ãŸ a ã«ï¼‘å‹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¯¾å±€æ•°: {games_b_to_a}")

            # b ã‹ã‚‰è¦‹ãŸ a ã¸ã®å‹ç‡
            if 0 <= difference_b_to_a:
                Wba = get_win_rate_for_upper_rating(games_b_to_a)
            else:
                Wba = get_win_rate_for_lower_rating(games_b_to_a)

            print(f"* b ã‹ã‚‰è¦‹ãŸ a ã¸ã®å‹ç‡(Wba): {Wba}")

            offset = math.floor(K * Wba)
            ratings[1] += offset
            ratings[2] -= offset
            print(f"* K: {K},  offset: {offset},  ratings: A {ratings[1]}, B {ratings[2]}")

        # B ãŒå‹ã£ãŸ
        elif result == 2:
            print("""\
+-------+
| B win |
+-------+\
                  """)

            # a ã‹ã‚‰è¦‹ãŸ b ã¨ã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®
            difference_a_to_b = ratings[2] - ratings[1]
            print(f"* a ã‹ã‚‰è¦‹ãŸ b ã¨ã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å·®: {difference_a_to_b}")

            # a ã‹ã‚‰è¦‹ãŸ b ã«ï¼‘å‹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¯¾å±€æ•°
            games_a_to_b = get_games_by_rating_difference(difference_a_to_b)
            print(f"* a ã‹ã‚‰è¦‹ãŸ b ã«ï¼‘å‹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¯¾å±€æ•°: {games_a_to_b}")

            # a ã‹ã‚‰è¦‹ãŸ b ã¸ã®å‹ç‡
            if 0 <= difference_a_to_b:
                Wab = get_win_rate_for_upper_rating(games_a_to_b)
            else:
                Wab = get_win_rate_for_lower_rating(games_a_to_b)

            print(f"* a ã‹ã‚‰è¦‹ãŸ b ã¸ã®å‹ç‡(Wab): {Wab}")

            offset = math.floor(K * Wab)
            ratings[2] += offset
            ratings[1] -= offset
            print(f"* K: {K},  offset: {offset},  ratings: A {ratings[1]}, B {ratings[2]}")

        else:
            print("Error")


    def on_end_1():
        print(f"""\
+--------+
| result |
+--------+
* games:    aiko: {games[0]:4},  A win: {games[1]:4},  B win: {games[2]:4}
* ratings:  aiko: {ratings[0]:4},  A win: {ratings[1]:4},  B win: {ratings[2]:4}\
              """)

    print("""\
+-------+
| start |
+-------+\
          """)
    
    # ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯å‹•ãã¾ã›ã‚“
    print(f"* ratings: A {ratings[1]}, B {ratings[2]}")


    main(on_gyanken=on_gyanken_1,
         on_result=on_result_1,
         on_end=on_end_1)
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ğŸ‘†ã€€ãªã‚‹ã¹ãã€€æ•´æ•°ã«å¤‰æ›ã—ã¦ã¿ãŸãœã€  

![kifuwarabe-futsu.png](https://crieit.now.sh/upload_images/beaf94b260ae2602ca8cf7f5bbc769c261daf8686dbda.png)  
ã€Œã€€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°ã‚’ã€€å¢—ã‚„ãã†ãœï¼Ÿã€  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ãƒãƒƒãƒãƒ³ã‚°ã¯ã€€ã©ã†ã™ã‚“ã ãœï¼Ÿã€  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
ã€Œã€€ãƒ©ãƒ³ãƒ€ãƒ ãƒ»ãƒãƒƒãƒãƒ³ã‚°ã§ã€€ã„ã„ã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿã€  

# ãƒ•ã‚¡ã‚¤ãƒ«ã¸ä¿å­˜

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ãã®å‰ã«ã€€å¤§ä¼šã®çµæœã‚’ã€€ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ãœï¼Ÿã€  

```py
        # ãƒ•ã‚¡ã‚¤ãƒ«ã¸ä¿å­˜
        with open('data/step_2_0.csv', mode='w') as f:
            f.write(f"""\
player,  win, rating
------, ----, ------
  aiko, {games[0]:4}, {ratings[0]:6}
     A, {games[1]:4}, {ratings[1]:6}
     B, {games[2]:4}, {ratings[2]:6}
""")
```

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€ğŸ‘†ã€€ã“ã‚“ãªæ„Ÿã˜ã‹ã ãœï¼Ÿã€  

![ohkina-hiyoko-futsu2.png](https://crieit.now.sh/upload_images/96fb09724c3ce40ee0861a0fd1da563d61daf8a09d9bc.png)  
ã€Œã€€ãã‚Œã¯ã€€ï¼‘ï¼ï¼å±€ã®é›†è¨ˆã«ã¯ãªã‚‹ã‘ã©ã€  
å¤§ä¼šã‚’ã€€ï¼‘ï¼ï¼å›ã€€è¨˜éŒ²ã™ã‚‹ã«ã¯ï¼Ÿã€  

![ramen-tabero-futsu2.png](https://crieit.now.sh/upload_images/d27ea8dcfad541918d9094b9aed83e7d61daf8532bbbe.png)  
ã€Œã€€é›†è¨ˆã«ã€€è¶³ã—è¾¼ã‚€ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼‘ï¼ï¼å€‹ä½œã‚Œã°ã„ã„ã®ã§ã¯ï¼Ÿã€  

.